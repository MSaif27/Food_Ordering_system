{% extends 'orders/base.html' %}

{% block title %}Menu | LPU Food System{% endblock %}

{% block content %}
<div class="page-header">
  <div class="container">
    <h2 class="fw-bold mb-0"><i class="bi bi-grid me-2"></i>Food Menu</h2>
    <p class="mb-0 opacity-75">Browse and add items to your cart</p>
  </div>
</div>

<div class="container pb-5">

  <!-- Filters -->
  <div class="card mb-4 p-3">
    <form method="get" class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label fw-semibold">Filter by Category</label>
        <select name="category" class="form-select" onchange="this.form.submit()">
          <option value="">All Categories</option>
          {% for key, label in categories %}
          <option value="{{ key }}" {% if category_filter == key %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label fw-semibold">Filter by Stall</label>
        <select name="stall" class="form-select" onchange="this.form.submit()">
          <option value="">All Stalls</option>
          {% for stall in stalls %}
          <option value="{{ stall.id }}" {% if stall_filter == stall.id|stringformat:"s" %}selected{% endif %}>{{ stall.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <a href="{% url 'cart' %}" class="btn btn-primary w-100">
          <i class="bi bi-cart3 me-2"></i>View Cart
          {% if cart_count %}<span class="badge bg-warning text-dark ms-1">{{ cart_count }}</span>{% endif %}
        </a>
      </div>
    </form>
  </div>

  <!-- Food Items Grid -->
  <div class="row g-4">
    {% for item in items %}
    <div class="col-md-4 col-sm-6">
      <div class="card h-100">
        {% if item.image %}
          <img src="{{ item.image.url }}" class="card-img-top" style="height:200px;object-fit:cover;" alt="{{ item.name }}">
        {% else %}
          <div class="d-flex align-items-center justify-content-center bg-light" style="height:180px;font-size:3rem;">
            {% if item.category == 'beverages' %}‚òï{% elif item.category == 'breakfast' %}ü•û{% elif item.category == 'lunch' %}üç±{% else %}üçî{% endif %}
          </div>
        {% endif %}

        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <h6 class="card-title fw-bold mb-0">{{ item.name }}</h6>
            <span class="badge bg-light text-dark border">{{ item.get_category_display }}</span>
          </div>
          <p class="text-muted small mb-2">{{ item.description|truncatechars:70 }}</p>
          <p class="text-muted small mb-2"><i class="bi bi-shop me-1"></i>{{ item.stall.name }}</p>
          <div class="d-flex justify-content-between align-items-center">
            <span class="fw-bold text-success fs-5">‚Çπ{{ item.price }}</span>
            <small class="text-muted"><i class="bi bi-clock me-1"></i>~{{ item.preparation_time }} min</small>
          </div>
        </div>

        <div class="card-footer bg-transparent">
          <form action="{% url 'add_to_cart' item.id %}" method="post" class="d-flex gap-2">
            {% csrf_token %}
            <input type="number" name="quantity" value="1" min="1" max="10"
                   class="form-control" style="width:70px;">
            <button type="submit" class="btn btn-primary flex-grow-1">
              <i class="bi bi-cart-plus me-1"></i>Add
            </button>
          </form>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12 text-center py-5 text-muted">
      <i class="bi bi-search fs-1"></i>
      <p class="mt-3">No food items found. Try a different filter.</p>
    </div>
    {% endfor %}
  </div>

</div>
{% endblock %}
